@page "/report/viewer"
@using SSRBlazor.Components.Layout
@layout MainLayout
@using MudBlazor
@using SSRBlazor.Services

<PageTitle>Report Viewer</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4" Style="height: 90vh; display: flex; flex-direction: column;">
    @if (_isLoading)
    {
        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Style="flex-grow: 1;">
            <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6" Class="mt-4">Generating Report...</MudText>
        </MudStack>
    }
    else if (!string.IsNullOrEmpty(_errorMessage))
    {
        <MudAlert Severity="Severity.Error" Variant="Variant.Filled">@_errorMessage</MudAlert>
    }
    else if (_reportData != null)
    {
        <MudPaper Elevation="0" Class="d-flex justify-space-between align-center px-4 py-2 mb-2">
            <MudText Typo="Typo.h6">@_fileName</MudText>
            <MudStack Row="true">
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Download" OnClick="DownloadReport">Download</MudButton>
                <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Close" OnClick="CloseWindow">Close</MudButton>
            </MudStack>
        </MudPaper>

        @if (_isPdf || _isHtml)
        {
            <div style="flex-grow: 1; border: 1px solid #ccc;">
                <object data="@_dataUrl" type="@_contentType" style="width: 100%; height: 100%;">
                    <p>Alternative text - include a link <a href="@_dataUrl">to the PDF!</a></p>
                </object>
            </div>
        }
        else
        {
             <MudAlert Severity="Severity.Info">Report generated. Click Download to save the file.</MudAlert>
        }
    }
</MudContainer>
